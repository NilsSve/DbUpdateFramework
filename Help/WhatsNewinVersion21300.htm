<!DOCTYPE html>

<html>
	
<head>
	<title>What's New in Version 2.1.3.0.0</title>
	<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Help for the DataFlex Database Update Framework" />
    <meta name="generator" content="HelpNDoc Professional Edition 7.1.0.253" />
	
	
	
	<link type="text/css" rel="stylesheet" media="all" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/hnd.css" />
	<!--[if lte IE 8]>
		<link type="text/css" rel="stylesheet" media="all" href="css/ielte8.css" />
	<![endif]-->

	<style type="text/css">
		#topic_header
		{
			background-color: #EFEFEF;
		}
	</style>

	

	<script type="text/javascript" src="js/chmRelative.js"></script>
	
	
</head>

<body>



	
	
	<div id="topic_content">
		
<p></p>
<h1 class="rvps7"><span class="rvts0"><span class="rvts23">Version 2.1.3.0 (Released October 2019)</span></span></h1>
<p class="rvps2"><span class="rvts39">If you previously only have used DUF 1.0, it is imporant that you first read </span><a class="rvts47" href="NewFeatures.htm">What's New in Version 2.0.0.00</a></p>
<p class="rvps2"><span class="rvts38"><br/></span></p>
<p class="rvps2"><span class="rvts38">It is crusial that both the DataAccess database driver and the database client version are of the right version(s) for your program to run successfully. A new message and a new event was introduced to automatically check both of these versions at program start up. The new event was created for the cDbUpdateHandler class (the outer DUF object). The event was named </span><span class="rvts45">OnCreate</span><span class="rvts38"> and the function name is </span><span class="rvts45">Function </span><a class="rvts46" href="UtilLowestAllowedMSSQLDRV_And_Cl.htm">UtilLowestAllowedMSSQLDRV_And_ClientVersion</a></p>
<p class="rvps2"><span class="rvts38"><br/></span></p>
<p class="rvps2"><span class="rvts39">Note: It is important to understand that you should </span><span class="rvts45">never put any update code</span><span class="rvts39"> inside the new OnCreate event, as it will always be executed when the program is started.</span></p>
<p class="rvps2"><span class="rvts39"><br/></span></p>
<p class="rvps2"><span class="rvts38">Your code could look like this;</span></p>
<p class="rvps2"><span class="rvts37"><br/></span></p>
<p class="rvps11"><span class="rvts35">Object oDbUpdateHandler is an cDbUpdateHandler&nbsp;</span><br/><span class="rvts35">&nbsp; &nbsp; Set piDbVersionFileNumber to 117</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; Set piDbVersionFieldNumber to 1</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; Set pbAutoCreateDbVersionTable to True &nbsp;&nbsp;</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; Set psCollation to "Latin1_General_CS_AS"&nbsp;</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; Set pbEnableCancelButton to True</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp;&nbsp;</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; </span><span class="rvts36">Procedure OnCreate</span></p>
<p class="rvps11"><span class="rvts36">&nbsp; &nbsp; &nbsp; &nbsp; String sVersionInfo &nbsp;</span></p>
<p class="rvps11"><span class="rvts36">&nbsp; &nbsp; &nbsp; &nbsp; Get UtilLowestAllowedMSSQLDRV_And_ClientVersion "6.3.0.13" 10 True True to sVersionInfo</span></p>
<p class="rvps11"><span class="rvts36">&nbsp; &nbsp; End_Procedure</span></p>
<p class="rvps11"><span class="rvts35"></span><br/><span class="rvts35">End_Object</span></p>
<p class="rvps2"><span class="rvts34"><br/></span></p>
<p class="rvps2"><span class="rvts12">A series of new functions were introduced to make the transformation from the DataFlex Embedded database (*.dat tables) to SQL. To make the transition smoother it is important that all *.dat tables first are repaired and reindexed. It is also important that *no* nul or zero date values exist in the *.dat tables as SQL doesn't like that at all and will break the copying of values over to SQL.</span></p>
<p class="rvps2"><span class="rvts11"><br/></span></p>
<p class="rvps2"><span class="rvts12">To make it really easy a series of new "initializing" functions were combined into one; </span><span class="rvts13">Function </span><a class="rvts42" href="UtilPrepareDataFolderForSQLConve.htm">UtilPrepareDataFolderForSQLConversion</a><span class="rvts12">.</span></p>
<p class="rvps2"><span class="rvts34"><br/></span></p>
<p class="rvps11"><span class="rvts35">Object oDbUpdateHandler is an cDbUpdateHandler&nbsp;</span><br/><span class="rvts35">.</span></p>
<p class="rvps11"><span class="rvts35">.</span></p>
<p class="rvps11"><span class="rvts35">.</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; Object oDbUpateVersion1.1 is a cDbUpdateVersion</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; &nbsp; &nbsp; Set pnVersionNumber to 1.1</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; &nbsp; &nbsp; Procedure OnUpdate</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Boolean bOK&nbsp;</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="rvts36">Get UtilPrepareDataFolderForSQLConversion True True True True True to bOK</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; &nbsp; &nbsp; End_Procedure</span></p>
<p class="rvps11"><span class="rvts35">&nbsp; &nbsp; End_Object</span></p>
<p class="rvps11"><span class="rvts35"></span><br/><span class="rvts35">End_Object</span></p>
<p class="rvps2"><span class="rvts34"><br/></span></p>
<p class="rvps2"><span class="rvts40">The </span><span class="rvts41">UtilPrepareDataFolderForSQLConversion </span><span class="rvts40">function is a combination of five other functions;</span></p>
<p class="rvps2"><span class="rvts40"><br/></span></p>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: decimal;">
 <li value="1" class="rvps2"><span class="rvts38">UtilMoveMiscFilesToBackupFolder that moves a number of files from the Data folder to a sub backup folder.</span></li>
 <li value="2" class="rvps2"><span class="rvts38">UtilTableFixALLBogusFilelistEntries, removes any Filelist.cfg entries that doesn't have a corresponding .Dat or .Int file in the Data folder.</span></li>
 <li value="3" class="rvps2"><span class="rvts38">UtilTableConvertALLTablesFrom23Format converts any *.Dat table from 2.3 format to 3.0/4.0 that more modern DataFlex versions are using. This is essential for DataFlex to be able to repair &amp; reindex tables.</span></li>
 <li value="4" class="rvps2"><span class="rvts38">UtilTableRepairAndReindexALL - Repairs (and creates *.bad files) for all .Dat tables in Filelist.cfg and then reindex them.</span></li>
 <li value="5" class="rvps2"><span class="rvts38">UtilTablesFixAllDateBogusValues - Checks all Filelist.cfg tables and all fields for Date values, and changes all date values lower than the predefined constant CS_DUFLowestAllowedDateValue (= "01/01/1753"). That constant can be changed if really needed.</span></li>
</ol>
<p class="rvps2"><span class="rvts37"><br/></span></p>
<p class="rvps2"><span class="rvts11">As explained in "What's New in Version 2.0.0.00" you should use the new tool </span><a class="rvts44" href="DUFCodeGenerator.htm">DUF Code Generator</a><span class="rvts11"> to auto-generate an "image" of your current/latest database version. Use the tool to generate a file name like e.g. "DUF_MultipleTables1_5.pkg" and Use it inside the cDbUpdateHandler object.</span></p>
<p class="rvps2"><span class="rvts11"><br/></span></p>
<p class="rvps2"><span class="rvts11">The main message that is used by the auto-generated code logic is </span><a class="rvts44" href="ApiTableUpdate.htm">ApiTableUpdate</a><span class="rvts11">. New logic for the </span><span class="rvts43">ApiTableUpdate</span><span class="rvts11"> function works like this. If a "From" table (from e.g. DUF_MultiTables1_5.pkg) is an SQL database driver and the "To" database table is a *.dat table (on the machine it is running on), the logic will first check if the table already exists on the SQL back-end. And if so it will attach to the existing SQL table rather than trying to convert the .Dat table to SQL.</span></p>
<p class="rvps2"><span class="rvts11"><br/></span></p>
<p class="rvps2"><span class="rvts11">If the "To" table is a .Dat table and the "From" table is in the SQL, the .Dat table will be converted to SQL.</span></p>
<p class="rvps2"><span class="rvts11"><br/></span></p>
<p></p>

	</div>
	
	
		<div id="topic_footer">

			<div id="topic_footer_content">
				Copyright &copy; 2016-2020 RDC Tools International. All Rights Reserved. Portions Copyright Data Access Worldwide, Mertech Data Systems, Inc.
			</div>
		</div>
	

	
	

	
</body>
	
</html>

