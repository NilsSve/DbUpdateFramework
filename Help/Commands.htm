<!DOCTYPE html>

<html>
	
<head>
	<title>Commands</title>
	<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Help for the DataFlex Database Update Framework" />
    <meta name="generator" content="HelpNDoc Professional Edition 7.1.0.253" />
	
	
	
	<link type="text/css" rel="stylesheet" media="all" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/hnd.css" />
	<!--[if lte IE 8]>
		<link type="text/css" rel="stylesheet" media="all" href="css/ielte8.css" />
	<![endif]-->

	<style type="text/css">
		#topic_header
		{
			background-color: #EFEFEF;
		}
	</style>

	

	<script type="text/javascript" src="js/chmRelative.js"></script>
	
	
</head>

<body>



	
	
	<div id="topic_content">
		
<p></p>
<h1 class="rvps7"><span class="rvts0"><span class="rvts23">SQLIncludeScriptFile - The Database Update Framework</span></span></h1>
<p class="rvps13"><span class="rvts65">See Also: </span><a class="rvts57" href="Overview.htm">Overview of the DataFlex Database Update Framework</a></p>
<p class="rvps27"><span class="rvts102">Command</span></p>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps27"><span class="rvts104">SQLIncludeScriptFile</span></p>
<p class="rvps2"><span class="rvts99"><br/></span></p>
<p class="rvps27"><span class="rvts102">Purpose</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts11">Use the </span><span class="rvts11">SQLIncludeScriptFile command to include a SQL Script file as a resource into the program. </span><span class="rvts14">It is suggested that a special workspace folder named "Scripts" is created where all .sql script files are kept.</span></p>
<p class="rvps2"><span class="rvts11"><br/></span></p>
<p class="rvps27"><span class="rvts102">Syntax</span></p>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps11"><span class="rvts74">SQLIncludeScriptFile {SQL script file} as {SQL script resource name}</span></p>
<p class="rvps2"><span class="rvts74"><br/></span></p>
<p class="rvps27"><span class="rvts102">What it does</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts11">It tells the compiler to include a SQL script file as a resource in the program. The resource can later be retrieved from memory while running the program. It is highly recommended to use the same name for the resource as the input file name that is to be included by the compiler (without the relative path). </span><span class="rvts14">The parameters are compiler directives and they should </span><span class="rvts49">not</span><span class="rvts14"> be surrounded by quotes (""). The default path for embedded resources is the Data folder. If the file to include is not in your Data folder, use a relative path.</span></p>
<p class="rvps2"><span class="rvts11"><br/></span></p>
<p class="rvps27"><span class="rvts102">Example 1</span></p>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps11"><span class="rvts74">Procedure OnClick</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; String sInfoText&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Boolean bOK</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; TimeSpan tsTotalQueryTime</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Integer iRetval</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp;&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // The default path for the include_resource command is the Data folder. So anything else needs a path.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // Note: The file name and the resource name (the 'as' part) needs to be exactly the same.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp;&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; </span><span class="rvts79">SQLIncludeScriptFile ..\Scripts\CreateOrderEntry.sql as CreateOrderEntry.sql</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Get YesNo_Box "This will create the [OrderEntry] database from the DataFlex samples for ;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Microsoft SQL Server, complete with data. If it exists it will first be dropped, then&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; re-created and populated with new data. Continue?" to iRetval</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; If (iRetval &lt;&gt; MBR_Yes) Begin</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; Procedure_Return</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; End</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Send StartWorkingMessage "Executing SQL Script. Please wait..."</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Get SqlUtilExecuteResource of ghoDbUpdateFunctionLibrary "CreateOrderEntry.sql" MSSQLDRV_ID False to bOK</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Send StopWorkingMessage &nbsp; &nbsp;</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; If (bOK = True) Begin</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; Get ptsTotalQueryTime of ghoDbUpdateFunctionLibrary to tsTotalQueryTime</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; Move ("Success! DataFlex Order Entry Sample Database was created as [OrderEntry]. ;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Time elapsed:" * String(tsTotalQueryTime)) to sInfoText</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp;End&nbsp;</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp;Else Begin&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Send UtilShowErrorList of ghoDbUpdateFunctionLibrary</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Move ("Nope, that didn't work. There was a problem running the script.\n\n" + ;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"See Notepad for details...") to sInfoText</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp;End</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp;Send Info_Box sInfoText</span></p>
<p class="rvps11"><span class="rvts74">End_Procedure</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps27"><span class="rvts102">Example 2</span></p>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps11"><span class="rvts74">Procedure MyDropColumnMessage String sTableName String sColumnName</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Boolean bOK</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; tSQLScriptArraySQLScriptArray</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Integer iSize iCount</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // The default path for the include_resource command is the Data folder. So anything else needs a path.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // Note: The file name and the resource name (the 'as' part) needs to be exactly the same.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; </span><span class="rvts79">SQLIncludeScriptFile ..\Scripts\DropConstraintAndColumnNameMSSQL.sql as DropConstraintAndColumnNameMSSQL.sql</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // This script file is provided in the "Scripts" workspace folder.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // It first drops the default constraint for the passed table column and then drops the</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; // the column.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Get SqlUtilReadResource of ghoDbUpdateFunctionLibrary "</span><span class="rvts79">DropConstraintAndColumnNameMSSQL</span><span class="rvts74">.sql" ;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; MSSQLDRV_ID False to SQLScriptArray</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Move (SizeOfArray(SQLScriptArray)) to iSize</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Decrement iSize</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; For iCount from 0 to iSize</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; If (SQLScriptArray.sSQLScriptArray[iCount] contains "TABLE_NAME_XXX") Begin</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Move (Replaces("TABLE_NAME_XXX", SQLScriptArray[iCount], String(sTableName)))) to ;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SQLScriptArray.sSQLScriptArray[iCount]</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; End</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; If (SQLScriptArray.sSQLScriptArray[iCount] contains "COLUMN_NAME_XXX") Begin</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Move (Replaces("COLUMN_NAME_XXX", SQLScriptArray[iCount], String(sColumnName)))) to ;</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SQLScriptArray.sSQLScriptArray[iCount]</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; &nbsp; &nbsp; End</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Loop</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; Get SqlUtilExecuteEmbeddedScript of ghoDbUpdateFunctionLibrary SQLScriptArray MSSQLDRV_ID False "" to bOK</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp;&nbsp;</span></p>
<p class="rvps11"><span class="rvts74">End_Procedure</span></p>
<p class="rvps11"><span class="rvts74"><br/></span></p>
<p class="rvps2"><span class="rvts34"><br/></span></p>
<p class="rvps2"><span class="rvts103">Command source</span></p>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps11"><span class="rvts74">#COMMAND </span><span class="rvts79">IncludeSQLScriptFile</span><span class="rvts74"> _TR "AS" _R</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; #Set Q$ DF_RESOURCE_TYPE_LINE &nbsp; &nbsp; // default to binary.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; #Replace !3.RSC |CI!ZR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// create unique resource id.</span></p>
<p class="rvps11"><span class="rvts74">&nbsp; &nbsp; #Resource !1 !Zr !q !3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// register new resource.</span></p>
<p class="rvps11"><span class="rvts74">#ENDCOMMAND</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps27"><span class="rvts102">Notes</span></p>
<ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
 <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: circle;">
  <li style="margin-left: 0px" class="rvps28"><span class="rvts100">For obvious reasons the SQL Script </span><span class="rvts101">filename</span><span class="rvts100"> must be stripped from any space characters and also characters outside the A-Z range.</span></li>
 </ul>
</ul>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps2"><span class="rvts55"><br/></span></p>
<p class="rvps2"><span class="rvts55">Next Topic</span></p>
<p class="rvps5"><span class="rvts22"><br/></span></p>
<p class="rvps5"><a class="rvts22" href="Tools.htm">Tools</a></p>
<p></p>

	</div>
	
	
		<div id="topic_footer">

			<div id="topic_footer_content">
				Copyright &copy; 2016-2020 RDC Tools International. All Rights Reserved. Portions Copyright Data Access Worldwide, Mertech Data Systems, Inc.
			</div>
		</div>
	

	
	

	
</body>
	
</html>

